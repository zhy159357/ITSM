<!DOCTYPE html>
<html lang="zh" xmlns:th="http://www.thymeleaf.org" >
<head>
    <th:block th:include="include :: header('应用系统申请审核')" />
    <th:block th:include="include :: datetimepicker-css" />
    <th:block th:include="include :: select2-css" />
    <style type="text/css">
		label.error{
			position:relative;
			right:0px;
			top:0px;
			color:#ef392b;
			font-size:12px;
			z-index:99;
		}
	</style>
</head>
<body class="white-bg">
    <div class="wrapper wrapper-content animated fadeInRight ibox-content">
        <form class="form-horizontal m" id="form-sysReq-audit" th:object="${sysReq}">
        <h4 class="form-header h4">基本信息</h4>
            <input name="id" th:field="*{id}" type="hidden">
            <div class="row">
            	<div class="col-sm-6">
		            <div class="form-group">
		                <label class="col-sm-4 control-label is-required">系统编码</label>
		                <div class="col-sm-8">
		                    <input name="code" th:field="*{code}" class="form-control" type="text" readonly>
		                </div>
		            </div>
		         </div>
		         <div class="col-sm-6">
					<div class="form-group">
						<label class="col-sm-4 control-label is-required">系统名称</label>
						<div class="col-sm-8">
							<input name="name" th:field="*{name}" class="form-control" type="text" readonly>
						</div>
					</div>
				</div>
			</div>
			<div class="row">
            	<div class="col-sm-6">
					<div class="form-group">
						<label class="col-sm-4 control-label is-required">所属机构</label>
						<div class="col-sm-8">
							<input name="oragn" id="organ" th:value="*{organid}" class="form-control" type="hidden">
							<input th:value="*{organ}" class="form-control" type="text" readonly>
						</div>
					</div>
				</div>
                <div class="col-sm-6">
					<div class="form-group">
						<label class="col-sm-4 control-label">所属处室</label>
						<div class="col-sm-8">
							<input name="office" id="office" th:value="*{officeid}" class="form-control" type="hidden">
							<input th:value="*{office}" class="form-control" type="text" readonly>
						</div>
					</div>
				</div>
            </div>
            <div class="row">
            	<div class="col-sm-6">
					<div class="form-group">
						<label class="col-sm-4 control-label is-required">所属部门</label>
						<div class="col-sm-8">
							<input name="dept" id="dept" th:value="*{deptid}" class="form-control" type="hidden">
							<input th:value="*{dept}" class="form-control" type="text" readonly>
						</div>
					</div>
				</div>
                <div class="col-sm-6">
					<div class="form-group">
						<label class="col-sm-4 control-label">所属负责人</label>
						<div class="col-sm-8">
							<input name="charge" th:value="*{chargeid}" class="form-control" type="hidden">
							<input class="form-control" th:value="*{charge}" type="text" readonly>
						</div>
					</div>
				</div>
            </div>
            <div class="row">
             	<div class="col-sm-6">
					<div class="form-group">
						<label class="col-sm-4 control-label is-required">系统分类</label>
						<div class="col-sm-8">
							<input name="sysclass" id="sysclass" th:value="*{sysclassid}" class="form-control" type="hidden">
							<input th:value="*{sysclass}" class="form-control" type="text" readonly>
						</div>
					</div>
				</div>
            	<div class="col-sm-6">
					<input  id="check" th:field="*{check}" type="hidden">
		            <div class="form-group">
		                <label class="col-sm-4 control-label is-required">参与考核</label>
		                <div class="col-sm-8">
		                    <input name="check" id="checkStr" class="form-control" type="text" readonly>
		                </div>
		            </div>
		        </div>
            </div>
            <div class="row">
            	<div class="col-sm-6">
					<input  id="important" th:field="*{important}" type="hidden">
		            <div class="form-group">
		                <label class="col-sm-4 control-label is-required">是否重要系统</label>
		                <div class="col-sm-8">
		                    <input name="important" id="importantStr" class="form-control" type="text" readonly>
		                </div>
		            </div>
		        </div>
            	<div class="col-sm-6">
					<input  id="mark" th:field="*{mark}" type="hidden">
		            <div class="form-group">
		                <label class="col-sm-4 control-label is-required">状态</label>
		                <div class="col-sm-8">
		                    <input name="mark" id="markStr" class="form-control" type="text" readonly>
		                </div>
		            </div>
		        </div>	
            </div>
            <h4 class="form-header h4">申请信息</h4>
           <div class="row">
            	<div class="col-sm-6">
					<div class="form-group">
						<label class="col-sm-4 control-label is-required">受理处室</label>
						<div class="col-sm-8">
							<input name="auditDept" th:value="*{auditDeptid}" class="form-control" type="hidden">
							<input th:value="*{auditDept}" class="form-control" type="text" readonly>
						</div>
					</div>
				</div>
                <div class="col-sm-6">
					<div class="form-group">
						<label class="col-sm-4 control-label is-required">审核人</label>
						<div class="col-sm-8">
							<input name="auditor" th:value="*{auditorid}" class="form-control" type="hidden">
							<input class="form-control" th:value="*{auditor}" type="text" readonly>
						</div>
					</div>
				</div>
            </div>
            <div class="row">
            	<div class="col-sm-6">
					<div class="form-group">
						<label class="col-sm-4 control-label is-required">受理处室</label>
						<div class="col-sm-8">
								   <input name="dealDeptid" type="hidden" th:value="*{dealDeptid}" id="dealDeptid"/>
		                           <select id="dealDept" name="dealDept" onchange="selectAuditor(this.value)" class="form-control noselect2" required>
		                           </select>
		                </div>
					</div>
				</div>
                <div class="col-sm-6">
					<div class="form-group">
						<label class="col-sm-4 control-label is-required">处理人</label>
						<div class="col-sm-8">
								   <input name="dealerid" type="hidden" th:value="*{dealerid}" id="dealerid"/>
		                           <select th:value="*{dealer}" id="dealer" name="dealer" class="form-control noselect2" required>
		                           </select>
		                </div>
					</div>
				</div>
            </div>
            <div class="row">
            	<div class="col-sm-12">
					<div class="form-group">
						<label class="col-sm-2 control-label is-required">审核意见</label>
						<div class="col-sm-10">
							<textarea name="auditSug" th:field="*{auditSug}" maxlength="500" class="form-control" required></textarea>
						</div>
					</div>
				</div>
            </div>
        </form>
        <div class="row">
			<div class="col-sm-offset-5 col-sm-10">
				<button type="button" class="btn btn-sm btn-primary" onclick="audit()"><i class="fa fa-check"></i>通 过</button>&nbsp;
				<button type="button" class="btn btn-sm btn-danger" onclick="back()"><i class="fa fa-reply-all"></i>退 回</button>&nbsp;
				<button type="button" class="btn btn-sm btn-danger" onclick="closeIt()"><i class="fa fa-window-close"></i>关 闭 </button>
			</div>
		</div>
    </div>
    <th:block th:include="include :: footer" />
    <th:block th:include="include :: datetimepicker-js" />
    <th:block th:include="include :: select2-js" />
    <script th:src="@{/js/activiti.js}"></script>
    <script th:src="@{/js/validator.js}"></script>
    <script th:inline="javascript">
    	var prefix = ctx + "sysReq";
    	$("#form-sysReq-audit").validate({
        	onkeyup: false,
        	rules:{
        		auditSug:{
        			maxlength2:500
        		}
        	},
            focusCleanup: true
        });
    	 if($("#check").val()=="1"){
 	    	$("#checkStr").val("是");
 	    }else{
 	    	$("#checkStr").val("否");
 	    }
 	    
 	    if($("#important").val()=="1"){
 	    	$("#importantStr").val("是");
 	    }else{
 	    	$("#importantStr").val("否");
 	    }
 	    
 	    if($("#mark").val()=="1"){
 	    	$("#markStr").val("启用");
 	    }else{
 	    	$("#markStr").val("禁用");
 	    }
 	    
	    
	    function back(){
        	if ($.validate.form() ) {
                $.operate.saveTab(prefix + "/edit", $('#form-sysReq-audit').serialize());
            }
        }
        function audit() {
            if ($.validate.form() ) {
                $.operate.saveTab(prefix + "/audit", $('#form-sysReq-audit').serialize());
            }
        }
        function closeIt(){
        	 $.modal.closeTab();
        }
        function selectAuditDept(value){	
        	$("#dealDept").html("");//清空select列表数据
        	$.ajax({
        		    async:false,
        	　　　　type : "POST",
        	　　　　url:ctx + "accountReq/selectAuditDept",
        	　　　　dataType : "JSON",
        	　　　　data : {deptid:value},
        	　　success : function(msg) 
        	　　{
        			$("#dealDept").append("<option value=''>请选择受理处室</option>");
					for (var i = 0; i < msg.rows.length; i++) {
						var html = "<option value='"+msg.rows[i].orgId+"'";
						if($("#dealDeptid").val() == msg.rows[i].orgId){
							html = html+" selected ";
						}
						html =html+">"+msg.rows[i].orgName+"</option>"
	       	　　　　		$("#dealDept").append(html);
        	　　		}
        	　　},error:function(){
        	　　}
        	});
        }
        function selectAuditor(value){
        	$("#dealer").html("");//清空select列表数据
        	$.ajax({
        		    async:false,
        	　　　　type : "POST",
        	　　　　url:ctx + "accountReq/selectAuditor",
        	　　　　dataType : "JSON",
        	　　　　data : {orgid:value,deptid:$("#dept").val()},
        	　　success : function(msg) 
        	　　{
        			$("#dealer").append("<option value=''>请选择处理人</option>");
					for (var i = 0; i < msg.rows.length; i++) {
						var html = "<option value='"+msg.rows[i].pId+"'";
						if($("#dealerid").val() == msg.rows[i].pId){
							html = html+" selected ";
						}
						html = html + ">"+msg.rows[i].pName+"</option>";
	       	　　　　		$("#dealer").append(html);
        	　　		}
        	　　},error:function(){
        	　　}
        	});
        }
        

        $(document).ready(function(){
          selectAuditDept($("#organ").val());
          selectAuditor($("#dealDeptid").val());
        });
    </script>
</body>
</html>