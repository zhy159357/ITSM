<!DOCTYPE html>
<html lang="zh" xmlns:th="http://www.thymeleaf.org">
<head>
    <th:block th:include="include :: header('信息制度管理')"/>
    <th:block th:include="include :: ztree-css"/>
</head>
<body class="white-bg">
<div class="wrapper wrapper-content animated fadeInRight ibox-content">
    <form class="form-horizontal m" id="form-info-add">
        <input id="regime_info_id" name="regime_info_id" type="hidden"/>
        <div class="row">
            <div class="col-sm-6">
                <div class="form-group">
                    <label class="col-sm-4 control-label is-required">制度标题:</label>
                    <div class="col-sm-8">
                        <input class="form-control" id="regime_title" name="regime_title" required>
                    </div>
                </div>
            </div>
            <div class="col-sm-6">
                <div class="form-group">
                    <label class="col-sm-4 control-label ">关键字:</label>
                    <div class="col-sm-8">
                        <input class="form-control" type="text" name="key_word" id="key_word">
                    </div>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-sm-6">
                <div class="form-group">
                    <label class="col-sm-4 control-label is-required">印发日期:</label>
                    <div class="col-sm-8">
                        <input type="text" class="layui-input form-control" id="print_time" name="print_time" required>
                    </div>
                </div>
            </div>
            <div class="col-sm-6">
                <div class="form-group">
                    <label class="col-sm-4 control-label is-required">审核人:</label>
                    <div class="col-sm-8">
                        <select id="checker" name="checker" class="form-control" required>
                            <option th:each="user : ${checkerList}" th:text="${user.pName}"
                                    th:value="${user.pId}"></option>
                        </select>
                    </div>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-sm-12">
                <div class="form-group">
                    <label class="col-xs-2 control-label is-required" >制度摘要:</label>
                    <div class="col-xs-10">
                        <textarea name="regime_digest" id="regime_digest"  class="form-control"
                                  rows="5" required></textarea>
                    </div>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-sm-6">
                <div class="form-group">
                    <label class="col-sm-4 control-label is-required">类型一:</label>
                    <div class="col-sm-8">
                        <select id="type_one" name="type_one" class="form-control m-b" required>
                            <option value="0">基础制度与政策类</option>
                            <option value="1">管理办法与规定类</option>
                            <option value="2">操作规范与实施细则</option>
                        </select>
                    </div>
                </div>
            </div>
            <div class="col-sm-6">
                <div class="form-group">
                    <label class="col-sm-4 control-label is-required">类型二:</label>
                    <div class="col-sm-8">
                        <select id="type_two" name="type_two" class="form-control m-b" required>
                            <option value="0">系统</option>
                            <option value="1">网络</option>
                            <option value="2">应用</option>
                            <option value="3">安全</option>
                            <option value="4">动力</option>
                        </select>
                    </div>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-sm-6">
                <div class="form-group">
                    <label class="col-sm-4 control-label is-required">状态:</label>
                    <div class="col-sm-8">
                        <select id="current_state" name="current_state" class="form-control m-b" required>
                            <option value="0">正式</option>
                            <option value="1">试行</option>
                        </select>
                    </div>
                </div>
            </div>
            <div class="col-sm-6">
                <div class="form-group">
                    <label class="col-sm-4 control-label ">印发文号:</label>
                    <div class="col-sm-8">
                        <input class="form-control" type="text" name="folder_" id="folder_">
                    </div>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-sm-6">
                <div class="form-group">
                    <label class="col-sm-4 control-label ">四级制度:</label>
                    <div class="col-sm-8">
                        <select id="sytem_four" name="sytem_four" class="form-control m-b" >
                            <option value="0">一级</option>
                            <option value="1">二级</option>
                            <option value="2">三级</option>
                            <option value="3">四级</option>
                        </select>
                    </div>
                </div>
            </div>
            <div class="col-sm-6">
                <div class="form-group">
                    <label class="col-sm-4 control-label ">分类域:</label>
                    <div class="col-sm-8">
                        <select id="classify" name="classify" class="form-control m-b" >
                            <option value="0">服务治理</option>
                            <option value="1">服务管理</option>
                            <option value="2">常态运维</option>
                            <option value="3">应急态运维</option>
                            <option value="4">系统和设施运维和维护</option>
                            <option value="5">质量管理</option>
                            <option value="6">信息安全管理</option>
                        </select>
                    </div>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-sm-6">
                <div class="form-group">
                    <label class="col-sm-4 control-label ">提交人:</label>
                    <div class="col-sm-8">
                        <input class="form-control" id="commit_id" name="commit_id" th:value="${commit_id}" required
                               readonly>
                    </div>
                </div>
            </div>
            <div class="col-sm-6">
                <div class="form-group">
                    <label class="col-sm-4 control-label ">提交时间:</label>
                    <div class="col-sm-8">
                        <input class="form-control" type="text" name="commit_time" id="commit_time" required readonly>
                    </div>
                </div>
            </div>
        </div>
    </form>
    <!--<h4 class="form-header h4">附 件</h4>-->
    <!--<div class="col-md-12">-->
        <!--<div class="btn-group-sm" id="toolbar" role="group">-->
            <!--<a class="btn btn-primary single disabled" onclick="$.operate.edit()" style="float:right">-->
                <!--<i class="fa fa-edit"></i> 下载附件-->
            <!--</a>-->
            <!--<a class="btn btn-danger multiple disabled" onclick="$.operate.removeAll()" style="float:right">-->
                <!--<i class="fa fa-remove"></i> 删除附件-->
            <!--</a>-->
            <!--<a class="btn btn-success" onclick="upload()" style="float:right">-->
                <!--<i class="fa fa-upload"></i> 添加附件-->
            <!--</a>-->
        <!--</div>-->
        <!--<div class="form-group">-->
            <!--<div class="col-sm-12 select-table table-striped">-->
                <!--<table id="bootstrap-table"></table>-->
            <!--</div>-->
        <!--</div>-->
    <!--</div>-->
</div>
<div class="row">
    <div class="col-sm-offset-5 col-sm-10">
        <button type="button" class="btn btn-sm btn-primary" onclick="submitHandler(1)"><i class="fa fa-check"></i>暂存</button>&nbsp;
        <button type="button" class="btn btn-sm btn-primary" onclick="submitHandler()"><i class="fa fa-check"></i>提交</button>&nbsp;
        <button type="button" class="btn btn-sm btn-danger" onclick="closeItem()"><i class="fa fa-reply-all"></i>取消 </button>
    </div>
</div>
<th:block th:include="include :: footer"/>

<script type="text/javascript">

    var prefix = ctx + "system/info";

    //** 关闭选项卡 */
    function closeItem() {

        var index = parent.layer.getFrameIndex(window.name);
        parent.layer.close(index);//关闭当前页
    }

    layui.use('laydate', function () {
        var laydate = layui.laydate;
        //日期时间选择器
        laydate.render({
            elem: '#print_time'
            , type: 'date'
        });
        //自定义重要日
        laydate.render({
            elem: '#test18'
            , mark: {
                '0-10-14': '生日'
                , '0-12-31': '跨年' //每年的日期
                , '0-0-10': '工资' //每月某天
                , '0-0-15': '月中'
                , '2017-8-15': '' //如果为空字符，则默认显示数字+徽章
                , '2099-10-14': '呵呵'
            }
            , done: function (value, date) {
                if (date.year === 2017 && date.month === 8 && date.date === 15) { //点击2017年8月15日，弹出提示语
                    layer.msg('这一天是：中国人民抗日战争胜利72周年');
                }
            }
        });
    });

    //获取当前时间添加到input中
    var _input = document.getElementById('commit_time');
    var currentDate = new Date();
    currentDate = currentDate.getFullYear() + "-" + (currentDate.getMonth() + 1) + "-" + currentDate.getDate() + " " + currentDate.getHours() + ":" + currentDate.getMinutes() + ":" + currentDate.getSeconds();
    _input.value = currentDate; //赋值给input.value

    var prefix_attachment = ctx + "pub/attachment";
    $(function () {
        var options = {
            url: prefix_attachment + "/list",
            createUrl: prefix_attachment + "/add",
            updateUrl: prefix_attachment + "/edit/{id}",
            removeUrl: prefix_attachment + "/remove",
            detailUrl: prefix_attachment + "/edit/{id}",
            sortName: "fileTime",
            sortOrder: "desc",
            modalName: "附件列表",
            columns: [{
                checkbox: true
            },
                {
                    field: 'atId',
                    title: '附件ID',
                    visible: false
                },
                {
                    field: 'fileName',
                    title: '文件名称'
                },
                {
                    field: 'ownerId',
                    title: '上传人'
                },
                {
                    field: 'size',
                    title: '文件大小'
                },
                {
                    field: 'fileCiphertext',
                    title: '文件描述'
                },
                {
                    field: 'fileTime',
                    title: '上传时间'
                }]
        };
        $.table.init(options);
    });

    // 附件上传页面
    function upload() {
        var url = prefix + "/upload";
        $.modal.open("附件上传", url,'1100','620');
    }

    //获取当前时间添加到input中
    var _input = document.getElementById('commit_time');
    var currentDate = new Date();
    currentDate = currentDate.getFullYear() + "-" + (currentDate.getMonth() + 1) + "-" + currentDate.getDate() + " " + currentDate.getHours() + ":" + currentDate.getMinutes() + ":" + currentDate.getSeconds();
    _input.value = currentDate; //赋值给input.value


    function submitHandler() {
        if ($.validate.form()) {
            add();
        }
    }

    function add() {
        var commit_id = $("input[name='createBy']").val();
        var checker = $("#checker").find("option:selected").val();
        var folder_ = $("input[name='folder_']").val();
        var regime_title = $("input[name='regime_title']").val();
        var key_word = $("input[name='key_word']").val();
        var print_time = $("input[name='print_time']").val();
        var regime_digest = $("#regime_digest").val();
        var type_one = $("#type_one").find("option:selected").val();
        var type_two = $("#type_two").find("option:selected").val();
        var current_state = $("#current_state").find("option:selected").val();
        var sytem_four = $("#sytem_four").find("option:selected").val();
        var classify = $("#classify").find("option:selected").val();
        var commit_time = $("input[name='commit_time']").val();
        $.ajax({
            cache: true,
            type: "POST",
            url: ctx + "system/info/add",
            data: {
                "commit_id": commit_id,
                "checker": checker,
                "folder_": folder_,
                "regime_title": regime_title,
                "key_word": key_word,
                "print_time": print_time,
                "regime_digest": regime_digest,
                "type_one": type_one,
                "current_state": current_state,
                "type_two": type_two,
                "sytem_four": sytem_four,
                "classify": classify,
                "commit_time": commit_time
            },
            async: false,
            error: function (request) {
                $.modal.alertError("信息制度管理新增报错");
            },
            success: function (data) {
                $.operate.successCallback(data);
            }
        });
    }
</script>
</body>
</html>
